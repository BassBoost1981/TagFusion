import{j as e,A as V,b as r}from"./motion-BxWOwN3p.js";import{r as s}from"./vendor-CwvKdLiM.js";import{u as se,a as ie,b as le,L as O,c as p,G as ne}from"./index-CN-phHlX.js";import{u as oe}from"./i18n-fyWXc1Nl.js";import{X as re,_ as ce,n as ue,S as xe,g as he,j as me,f as pe,R as de,z as ge,E as fe,J as be,O as ye,Q as je}from"./icons-BPTnPYzs.js";import"./heroui-m--SptfW.js";import"./state-LdY94aua.js";import"./virtuoso-ZIEdzwmB.js";function Ee(){const{isOpen:c,currentImage:a,currentIndex:m,images:n,zoomLevel:u,close:f,next:k,previous:N,zoomIn:C,zoomOut:I,resetZoom:b,setZoom:y,goToIndex:W}=se(),{refreshImages:B}=ie(),z=le(),{t:l}=oe(),[T,d]=s.useState(null),[S,E]=s.useState(!1),[X,A]=s.useState(!0),[o,j]=s.useState(!1),[w,_]=s.useState(!0),J=s.useRef(null),F=s.useRef(null),[R,L]=s.useState(0),[P,$]=s.useState(0),[v,Y]=s.useState(!1),g=s.useRef({x:0,y:0,panX:0,panY:0}),K=s.useRef(null),D=u>O;s.useEffect(()=>{L(0),$(0)},[a?.path]),s.useEffect(()=>{u<=O&&(L(0),$(0))},[u]),s.useEffect(()=>{c&&a&&(E(!0),d(null),p.getFullImage(a.path).then(t=>{d(t),E(!1)}).catch(t=>{z(t.message),d(a.thumbnailBase64||null),E(!1)}))},[c,a?.path]),s.useEffect(()=>{if(!c||n.length<=1)return;[m-1,m+1].filter(i=>i>=0&&i<n.length).forEach(i=>{const x=n[i];x?.path&&p.getFullImage(x.path).catch(()=>{})})},[c,m,n]),s.useEffect(()=>{F.current&&w&&F.current.scrollIntoView({behavior:"smooth",block:"nearest",inline:"center"})},[m,w]);const Q=s.useCallback(t=>{t.preventDefault(),t.stopPropagation();const i=t.deltaY>0?-10:10,x=u+i;y(x)},[u,y]),q=s.useCallback(t=>{D&&(t.preventDefault(),Y(!0),g.current={x:t.clientX,y:t.clientY,panX:R,panY:P})},[D,R,P]),ee=s.useCallback(t=>{if(!v)return;const i=t.clientX-g.current.x,x=t.clientY-g.current.y;L(g.current.panX+i),$(g.current.panY+x)},[v]),Z=s.useCallback(()=>{Y(!1)},[]),te=s.useCallback(t=>{t.stopPropagation(),u===O?y(200):b()},[u,y,b]),M=s.useCallback(t=>{if(c)switch(t.key){case"Escape":f();break;case"ArrowLeft":N();break;case"ArrowRight":k();break;case"+":case"=":C();break;case"-":I();break;case"0":b();break;case"i":A(i=>!i);break}},[c,f,k,N,C,I,b]);s.useEffect(()=>(window.addEventListener("keydown",M),()=>window.removeEventListener("keydown",M)),[M]);const U=async t=>{if(!(!a||o)){j(!0);try{await p.rotateImages([a.path],t);const i=await p.getFullImage(a.path);d(i),B()}catch(i){z(i.message)}finally{j(!1)}}},H=async t=>{if(!(!a||o)){j(!0);try{await p.flipImages([a.path],t);const i=await p.getFullImage(a.path);d(i),B()}catch(i){z(i.message)}finally{j(!1)}}};if(!a)return null;const ae=T?`data:image/jpeg;base64,${T}`:a.thumbnailBase64?`data:image/jpeg;base64,${a.thumbnailBase64}`:a.thumbnailUrl||"";return e.jsx(V,{children:c&&e.jsxs(r.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2},className:"fixed inset-0 z-50 flex items-center justify-center",role:"dialog","aria-modal":"true","aria-label":`${l("lightbox.info")}: ${a.fileName}`,onClick:f,children:[e.jsx("div",{className:"absolute inset-0",style:{background:"rgba(0, 0, 0, 0.85)",backdropFilter:"blur(20px)"}}),e.jsxs(r.div,{ref:K,initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},transition:{type:"spring",stiffness:300,damping:25},className:"relative z-10 w-[95vw] h-[90vh] flex items-center justify-center overflow-hidden",style:{cursor:D?v?"grabbing":"grab":"default"},onClick:t=>t.stopPropagation(),onWheel:Q,onMouseDown:q,onMouseMove:ee,onMouseUp:Z,onMouseLeave:Z,onDoubleClick:te,children:[(S||o)&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center z-20",children:e.jsx(r.div,{animate:{rotate:360},transition:{duration:1,repeat:1/0,ease:"linear"},className:"w-12 h-12 border-4 border-cyan-400/30 border-t-cyan-400 rounded-full"})}),e.jsx(r.img,{src:ae,alt:a.fileName,className:"w-full h-full object-contain select-none",style:{transform:`translate(${R}px, ${P}px) scale(${u/100})`,opacity:S||o?.3:1,filter:o?"blur(2px)":"none",transition:v?"none":"transform 0.15s ease-out"},draggable:!1,initial:{opacity:0},animate:{opacity:S||o?.3:1}})]}),e.jsxs(r.div,{initial:{y:-50,opacity:0},animate:{y:0,opacity:1},exit:{y:-50,opacity:0},className:"absolute top-0 left-0 right-0 p-4 flex items-center justify-between",style:{background:"linear-gradient(180deg, rgba(0,0,0,0.7) 0%, transparent 100%)"},onClick:t=>t.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("span",{className:"text-white font-medium",children:a.fileName}),e.jsxs("span",{className:"text-slate-400 text-sm",children:[m+1," / ",n.length]})]}),e.jsx(h,{onClick:f,title:l("lightbox.close"),children:e.jsx(re,{size:20})})]}),n.length>1&&e.jsxs(e.Fragment,{children:[e.jsx(r.button,{initial:{x:-20,opacity:0},animate:{x:0,opacity:1},exit:{x:-20,opacity:0},onClick:t=>{t.stopPropagation(),N()},className:"absolute left-4 top-1/2 -translate-y-1/2 p-3 rounded-full transition-all hover:scale-110",style:{background:"rgba(255,255,255,0.1)",backdropFilter:"blur(10px)",border:"1px solid rgba(255,255,255,0.2)"},whileHover:{background:"rgba(6,182,212,0.3)"},whileTap:{scale:.95},title:l("lightbox.previous"),children:e.jsx(ce,{size:28,className:"text-white"})}),e.jsx(r.button,{initial:{x:20,opacity:0},animate:{x:0,opacity:1},exit:{x:20,opacity:0},onClick:t=>{t.stopPropagation(),k()},className:"absolute right-4 top-1/2 -translate-y-1/2 p-3 rounded-full transition-all hover:scale-110",style:{background:"rgba(255,255,255,0.1)",backdropFilter:"blur(10px)",border:"1px solid rgba(255,255,255,0.2)"},whileHover:{background:"rgba(6,182,212,0.3)"},whileTap:{scale:.95},title:l("lightbox.next"),children:e.jsx(ue,{size:28,className:"text-white"})})]}),w&&n.length>1&&e.jsx(r.div,{initial:{y:20,opacity:0},animate:{y:0,opacity:1},exit:{y:20,opacity:0},transition:{delay:.1},className:"absolute bottom-14 left-0 right-0 z-20",onClick:t=>t.stopPropagation(),children:e.jsx("div",{ref:J,className:"flex gap-1 overflow-x-auto py-1.5 px-4 mx-auto max-w-[90vw]",style:{scrollbarWidth:"none",msOverflowStyle:"none"},children:n.map((t,i)=>{const x=i===m,G=t.thumbnailBase64?`data:image/jpeg;base64,${t.thumbnailBase64}`:t.thumbnailUrl||"";return e.jsx("button",{ref:x?F:null,onClick:()=>W(i),title:t.fileName,className:`
                        flex-shrink-0 rounded overflow-hidden transition-all duration-150
                        outline-none focus-visible:ring-2 focus-visible:ring-cyan-400
                        ${x?"ring-2 ring-cyan-400 opacity-100 brightness-110":"opacity-40 hover:opacity-75"}
                      `,style:{width:56,height:40},children:G?e.jsx("img",{src:G,alt:t.fileName,className:"w-full h-full object-cover",draggable:!1,loading:"lazy"}):e.jsx("div",{className:"w-full h-full bg-slate-700 flex items-center justify-center",children:e.jsx("span",{className:"text-[8px] text-slate-400 truncate px-0.5",children:t.fileName})})},t.path)})})}),e.jsx(r.div,{initial:{y:50,opacity:0},animate:{y:0,opacity:1},exit:{y:50,opacity:0},className:"absolute bottom-0 left-0 right-0 p-4",style:{background:"linear-gradient(0deg, rgba(0,0,0,0.7) 0%, transparent 100%)"},onClick:t=>t.stopPropagation(),children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(V,{children:X&&e.jsxs(r.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},className:"flex items-center gap-4",children:[e.jsx("div",{className:"flex items-center gap-1",children:[0,1,2,3,4].map(t=>e.jsx(xe,{size:16,className:t<(a.rating||0)?"text-cyan-400":"text-slate-600",fill:t<(a.rating||0)?"currentColor":"none"},t))}),a.tags&&a.tags.length>0&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(he,{size:14,className:"text-cyan-400"}),e.jsxs("span",{className:"text-slate-300 text-sm",children:[a.tags.slice(0,5).join(", "),a.tags.length>5&&` +${a.tags.length-5}`]})]}),a.width&&a.height&&e.jsxs("span",{className:"text-slate-400 text-sm",children:[a.width," Ã— ",a.height]})]})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(h,{onClick:()=>_(t=>!t),title:l("lightbox.filmstrip"),children:e.jsx(me,{size:18,className:w?"text-cyan-400":""})}),e.jsx(h,{onClick:()=>A(t=>!t),title:l("lightbox.info"),children:e.jsx(pe,{size:18,className:X?"text-cyan-400":""})}),e.jsx("div",{className:"w-px h-6 bg-white/20 mx-2"}),e.jsx(h,{onClick:()=>U(-90),title:l("lightbox.rotateLeft"),disabled:o,children:e.jsx(de,{size:18})}),e.jsx(h,{onClick:()=>U(90),title:l("lightbox.rotateRight"),disabled:o,children:e.jsx(ge,{size:18})}),e.jsx("div",{className:"w-px h-6 bg-white/20 mx-1"}),e.jsx(h,{onClick:()=>H(!0),title:l("lightbox.flipHorizontal"),disabled:o,children:e.jsx(fe,{size:18})}),e.jsx(h,{onClick:()=>H(!1),title:l("lightbox.flipVertical"),disabled:o,children:e.jsx(be,{size:18})}),e.jsx("div",{className:"w-px h-6 bg-white/20 mx-2"}),e.jsx(h,{onClick:I,title:l("lightbox.zoomOut"),children:e.jsx(ye,{size:18})}),e.jsxs("span",{className:"text-white text-sm min-w-[50px] text-center",children:[u,"%"]}),e.jsx(h,{onClick:C,title:l("lightbox.zoomIn"),children:e.jsx(je,{size:18})})]})]})})]})})}function h({children:c,onClick:a,title:m,disabled:n=!1}){return e.jsx(ne,{onClick:n?void 0:a,title:m,disabled:n,variant:"ghost",size:"sm",className:"!text-white/80 hover:!text-white !bg-white/10 hover:!bg-cyan-500/30 !border-white/15 !backdrop-blur-md",children:c})}export{Ee as Lightbox};
